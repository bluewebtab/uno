{{ 'section-main-product.css' | asset_url | stylesheet_tag }}

<product-form id="add-to-cart-form" class="product-form">
    {%- form 'product', product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
      <template>
        <div>
          {% render 'product-option-row' %}
        </div>
      </template>
      <div class="product-form__buttons">
        <button
          @click="addToCart"
          type="submit"
          name="add"
          id="add-to-cart-button"
          class="product-form__submit button button--full-width {% if dynamic_checkout and product.selling_plan_groups == empty %}button--secondary{% else %}button--primary{% endif %}"
        {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}
        >
      
            {%- if product.selected_or_first_available_variant.available -%}
              {{ 'products.product.add_to_cart' | t }}
            {%- else -%}
              {{ 'products.product.sold_out' | t }}
            {%- endif -%}
        </button>
        {%- if dynamic_checkout -%}
          {{ form | payment_button }}
        {%- endif -%}
      </div>
    {%- endform -%}
</product-form>

<script>
    if(document.querySelector('#add-to-cart-form')){
        const productForm = Vue.createApp({
            delimiters: ['${', '}'],
            data(){
                return {
                  open: false,
                  variants: "",
                  selected: [],
                  form: {
                    selections: "",
                    options: ""
                  }
                }
            },
            created(){
                axios.get("/products/{{ product.handle }}.js")
                  .then(results => {
                    this.variant = results.data.variants[0].id
                  })
            },
            methods: {
                addToCart(event){
                    event.preventDefault()
                    let data = {
                      id: this.variant,
                      quantity: 1
                    }
                    axios.post('/cart/add.js', data)
                    .then((response) => {
                        console.log(response)
                    })
                }
            }
        }).mount('#add-to-cart-form')
    }
</script>